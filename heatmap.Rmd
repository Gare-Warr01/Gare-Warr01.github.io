
---
title: "Flu Heatmap by Year"
output: html_document
---

```{r setup, include=FALSE}
library(leaflet)
library(leaflet.extras)
library(dplyr)
library(readr)

flu_data <- read.csv("ICL_NREVSS_Summary.csv")
state_centers <- data.frame(state.center, State = state.name)

# Years to include
years <- 2018:2023
```

#  Flu Heatmaps (2018â€“2023)

```{r generate_heatmaps, results='asis', echo=FALSE}
for (year in years) {
  cat(paste0("## ", year, " Flu Case Heatmap\n\n"))

  yearly_flu <- flu_data %>%
    filter(Year == year) %>%
    group_by(State) %>%
    summarise(Total_Cases = sum(Total_Cases, na.rm = TRUE)) %>%
    left_join(state_centers, by = "State")

  pal <- colorNumeric("YlOrRd", domain = yearly_flu$Total_Cases)

  map <- leaflet(yearly_flu) %>%
    addProviderTiles(providers$CartoDB.Positron) %>%
    setView(lng = -98.583, lat = 39.833, zoom = 4) %>%
    addCircleMarkers(
      lng = ~x, lat = ~y,
      radius = ~sqrt(Total_Cases)/2,
      color = ~pal(Total_Cases),
      stroke = FALSE, fillOpacity = 0.8,
      popup = ~paste0("<b>", State, "</b><br>Total Cases: ", Total_Cases)
    ) %>%
    addLegend("bottomright", pal = pal, values = ~Total_Cases,
              title = paste("Total Cases in", year))

  print(map)
  cat("\n\n---\n\n")
}
```
